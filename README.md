# Docker Swarm NFS å­˜å‚¨æ¶æ„

ä¸€ä¸ªå®Œæ•´çš„Docker Swarmåˆ†å¸ƒå¼NFSå­˜å‚¨è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒè·¨èŠ‚ç‚¹è®¿é—®ã€è‡ªåŠ¨å¤‡ä»½å’Œæ•°æ®æ¢å¤ã€‚

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Docker Node   â”‚    â”‚   Docker Node   â”‚    â”‚   Docker Node   â”‚
â”‚     (vir02)     â”‚    â”‚     (ora01)     â”‚    â”‚     (ora02)     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    App    â”‚  â”‚    â”‚  â”‚    App    â”‚  â”‚    â”‚  â”‚    App    â”‚  â”‚
â”‚  â”‚ Services  â”‚  â”‚    â”‚  â”‚ Services  â”‚  â”‚    â”‚  â”‚ Services  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚        â”‚    â”‚        â”‚        â”‚    â”‚        â”‚        â”‚
â”‚        â”‚ NFS    â”‚    â”‚        â”‚ NFS    â”‚    â”‚        â”‚ NFS    â”‚
â”‚        â”‚        â”‚    â”‚        â”‚        â”‚    â”‚        â”‚        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”‚    â”‚        â”‚        â”‚    â”‚        â”‚        â”‚
â”‚  â”‚NFS Server â”‚  â”‚    â”‚        â”‚        â”‚    â”‚        â”‚        â”‚
â”‚  â”‚  Service  â”‚  â”‚    â”‚        â”‚        â”‚    â”‚        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚        â”‚        â”‚    â”‚        â”‚        â”‚
â”‚        â”‚        â”‚    â”‚        â”‚        â”‚    â”‚        â”‚        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”‚    â”‚        â”‚        â”‚    â”‚        â”‚        â”‚
â”‚  â”‚  Backup   â”‚  â”‚    â”‚        â”‚        â”‚    â”‚        â”‚        â”‚
â”‚  â”‚ Manager   â”‚  â”‚    â”‚        â”‚        â”‚    â”‚        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚        â”‚        â”‚    â”‚        â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                     â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     WebDAV Backup     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
dockerSwarm_syncNFSvolumes/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ backup-manager.sh           # å¤‡ä»½ç®¡ç†å·¥å…·
â”‚   â””â”€â”€ lib                         # åº“æ–‡ä»¶
â”œâ”€â”€ 
â””â”€â”€ README.md                       # æœ¬æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

## ğŸ› ï¸ å¤‡ä»½ç®¡ç†

### ä½¿ç”¨å¤‡ä»½ç®¡ç†å·¥å…·

```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x backup-manager.sh

# æŸ¥çœ‹å¸®åŠ©
./backup-manager.sh help

# åˆ—å‡ºæ‰€æœ‰å·å’Œå¿«ç…§
./backup-manager.sh list

# æ‰‹åŠ¨è§¦å‘å¤‡ä»½
./backup-manager.sh backup

# ä»å¤‡ä»½è¿˜åŸ (è°¨æ…æ“ä½œ)
./backup-manager.sh restore

# æ¸…ç©ºå·æ•°æ® (å±é™©æ“ä½œ)
./backup-manager.sh flush
```

### å¤‡ä»½åŠŸèƒ½ç‰¹æ€§

- âœ… **è‡ªåŠ¨å¤‡ä»½**: æ¯6å°æ—¶è‡ªåŠ¨å¤‡ä»½æ‰€æœ‰å·
- âœ… **å¢é‡å¤‡ä»½**: ä½¿ç”¨Kopiaå®ç°é«˜æ•ˆå¢é‡å¤‡ä»½
- âœ… **WebDAVå­˜å‚¨**: å¤‡ä»½åˆ°è¿œç¨‹WebDAVæœåŠ¡å™¨
- âœ… **ç‰ˆæœ¬ç®¡ç†**: ä¿ç•™å¤šä¸ªå¤‡ä»½ç‰ˆæœ¬
- âœ… **æ‰‹åŠ¨æ“ä½œ**: æ”¯æŒæ‰‹åŠ¨å¤‡ä»½å’Œè¿˜åŸ
- âœ… **å®‰å…¨ç¡®è®¤**: å±é™©æ“ä½œéœ€è¦å¤šé‡ç¡®è®¤

## ğŸ“Š NFSå·è¯´æ˜

| å·å | ç”¨é€” | æƒé™ | è¯´æ˜ |
|------|------|------|------|
| `shared_data` | å…±äº«æ•°æ® | è¯»å†™ | æ‰€æœ‰åº”ç”¨å…±äº«çš„æ•°æ® |
| `app_data` | Webåº”ç”¨æ•°æ® | è¯»å†™ | Webåº”ç”¨ä¸“ç”¨æ•°æ® |
| `app_api` | APIåº”ç”¨æ•°æ® | è¯»å†™ | APIåº”ç”¨ä¸“ç”¨æ•°æ® |
| `app_db` | æ•°æ®åº“æ•°æ® | è¯»å†™ | æ•°æ®åº“åº”ç”¨ä¸“ç”¨æ•°æ® |
| `app_configs` | åº”ç”¨é…ç½® | åªè¯» | åº”ç”¨é…ç½®æ–‡ä»¶ |


### å¤‡ä»½é…ç½®
- **å¤‡ä»½é—´éš”**: 6å°æ—¶
- **å¤‡ä»½å·¥å…·**: Kopia
- **å­˜å‚¨åç«¯**: WebDAV
- **åŠ å¯†**: AES-256åŠ å¯†
- **ä¿ç•™ç­–ç•¥**: è‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½


# æ£€æŸ¥å¤‡ä»½ä»“åº“çŠ¶æ€
docker exec $(docker ps --filter "label=com.docker.swarm.service.name=storage_backup_manager" --format "{{.ID}}" | head -1) \
  sh -c 'export KOPIA_CONFIG_PATH=/app/config/kopia.config && /bin/kopia repository status'

# æ‰‹åŠ¨æµ‹è¯•å¤‡ä»½
./backup-manager.sh backup
```

## ğŸ“ æ³¨æ„äº‹é¡¹

 **æ•°æ®å®‰å…¨**: åœ¨æ‰§è¡Œflushæˆ–restoreæ“ä½œå‰ï¼Œè¯·ç¡®ä¿äº†è§£æ“ä½œåæœ

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚
